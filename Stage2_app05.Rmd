---
title: 'Appendix 5: Planned analysis for mental rotation scores'
#tags: `PSA002`
output: html_document
#header-includes:
#  - \usepackage{caption}
#  - \usepackage{float}
#  - \captionsetup[table]{name=Table S,labelsep = period}
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = FALSE,
	message = FALSE,
	warning = FALSE
)
library(tidyverse)
library(lme4)
library(lmerTest)
library(ggplot2)
library(sjPlot)

# Import multiple-bytes string in English system
Sys.setlocale("LC_ALL","English") 
```



```{r PP-lme-data, message=FALSE, warning=FALSE, include=FALSE}
# import data file for the making of appendix
PP_lme_data <- dir(#path = "..",
      pattern = "PP_lme_data.csv",   ## include in-site and internet data
      recursive = TRUE, full.names = TRUE) %>% 
      read_csv() %>% 
  filter(Outlier == FALSE) %>% #filter outlier by time rule established above
  filter(SPV_bound == FALSE) %>%  ## Exclude the participants who had SPV accuracy < 70%
  mutate(Identical= factor(Identical,
                          levels = c("Y","N"),
                          labels = c("1SAME","0DIFF")))
```

### Model included data source

The preregistered plan had not consider the data sources. We conducted this model evaluate the difference between the data sources. 

```{r PP_source_lme, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

## Erase the analysis on data sources
PP.source.lme <- lmerTest::lmer(response_time ~ 
                   Source +                # Fixed effect
                    (1 | Subject) +   # By-subject random intercept
                    (1 | Picture1) +   # By-item random intercept
                    (1 | PSA_ID) +    # By-lab random intercept
                    (1 | Language),
                    data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                  ) 
tab_model(PP.source.lme, title="The mdoel included data sources as a fixed effect.")
```

### Planned analysis: Interaction of imagery scores and langauges

We evaluated the interaction of imagery scores and languages in three models. Based on the recommended practices(Barr et al., 2013; Brauer & Curtin, 2018), the models used the optimizer `bobyqa`. The final report decided `PP.lang.zero_slope.cor.lme` the best fitted model.

1. Null-effect models

```{r PP_null_lme, message=FALSE, warning=FALSE}
PP.intercept.lme <- lm(response_time ~ 1,
                    data = PP_lme_data
                    ) 

PP.subject.lme <- lmerTest::lmer(response_time ~ 1 +
                    (1 | Subject),   # By-subject random intercept
             data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                    ) 


PP.item.lme <- lmerTest::lmer(response_time ~ 1 +
                    (1 | Subject) +   # By-subject random intercept
                    (1 | Picture1),    # By-item random intercept
             data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                    ) 


PP.lab.lme <- lmerTest::lmer(response_time ~ 1 +
                    (1 | Subject) +   # By-subject random intercept
                    (1 | Picture1) +   # By-item random intercept
                    (1 | PSA_ID),    # By-lab random intercept
                    data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                    ) 

tab_model(PP.intercept.lme, title="Null effect mdoel: Only intercept")
tab_model(PP.subject.lme, title="Null effect mdoel with the random intercept of participant")
tab_model(PP.item.lme, title="Null effect mdoel with the random intercepts of participant and item")
tab_model(PP.lab.lme, title="Null effect mdoel with the random intercepts of participant, item, and laboratory")
```


```{r PP_lang_lme, message=FALSE, warning=FALSE}

PP.lang.add.cor.lme <- lmerTest::lmer(response_time ~ 
                    Identical+Language +                # Fixed effect
                    (1 | Subject) +   # By-subject random intercept
                    (1 | Picture1) +   # By-item random intercept
                    (1 | PSA_ID),    # By-lab random intercept
                    data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                    ) 


PP.lang.inter.cor.lme <- lmerTest::lmer(response_time ~ 
                    Identical*Language +                # Fixed effect
                    (1 | Subject) +   # By-subject random intercept
                    (1 | Picture1) +   # By-item random intercept
                    (1 | PSA_ID),    # By-lab random intercept
                    data = PP_lme_data,
                    control = lmerControl(optimizer = "bobyqa",optCtrl = list(maxfun = 1e6)) # Increase maximum number of iterations to facilitate model convergence 
                    ) 


tab_model(PP.lang.add.cor.lme, title="Model with addition of orientation setting and languages")
tab_model(PP.lang.add.cor.lme, title="Model with interaction of orientation setting and languages")

```

